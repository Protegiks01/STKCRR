[
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: forget_orphaned_epoch_data()] [Resurrection Attack] This function DELETEs orphaned blocks/microblocks from staging, allowing them to be re-processed - can an attacker exploit PoX reorgs to repeatedly resurrect and orphan the same blocks, causing processing loops? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: set_block_processed()] [Accept-Orphan Race] The function either accepts (sets attachable=1 for children) or orphans (calls delete_orphaned_epoch_data) based on the accept parameter - if accept is true but the sortition DB update fails, can children be marked attachable while the block is not truly accepted? (Critical)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: set_block_processed()] [Double Processing] The function checks if processed != 0 and logs that the block is already processed - but doesn't return early, allowing the UPDATE query to run again - can this cause duplicate entries in burn DB or incorrect processed_time? (Medium)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: free_block()] [Filename Race Condition] The function generates a random suffix for the .invalid file copy - but if two threads call free_block simultaneously for the same block, can both copies succeed while only one truncation occurs, leaving inconsistent state? (Medium)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: process_next_orphaned_staging_block()] [Unbounded Recursion] The function processes one orphaned block at a time, returning bool - if a chain of orphaned blocks is very long, can repeated calls cause stack overflow or take unbounded time? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: set_microblocks_processed()] [Missing Parent] The loop walks backward setting processed=1 for each microblock, but if a parent microblock is missing (returns Error::NoSuchBlockError), the caller should abort - can partial microblock confirmation create inconsistent state? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: delete_microblock_data()] [Data Loss] The function copies microblock data to invalidated_microblocks_data then DELETEs from staging_microblocks_data - if the INSERT fails but DELETE succeeds, is the microblock data permanently lost? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: get_staging_block_status()] [Query Ambiguity] The function queries 'processed' column and returns Some(true/false) or None - but what happens if multiple rows match the query (consensus_hash, block_hash) which should be unique? Can database corruption cause incorrect status? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: inner_read_one_i64()] [Overflow Error] The function sets expect_one and returns Overflow error if multiple rows found - but can this mask legitimate database corruption where duplicate entries exist for the same key? (Medium)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: load_block_data_blobs()] [Memory Exhaustion] The function loads all matching BLOBs into a Vec with no size limit - can an attacker exploit this by creating many large microblocks or blocks that cause OOM when loaded? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: has_blocks_with_microblock_pubkh()] [Height Filter Bypass] The query checks height >= minimum_block_height - but if minimum_block_height is set incorrectly (e.g., to 0 or i64::MIN), can this return false positives affecting poison microblock detection? (Medium)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: get_blocks_inventory()] [Inventory Spoofing] The function checks fault_injection.hide_blocks flag and can return false for valid blocks - can this flag be manipulated by an attacker to cause incorrect block inventory, leading to network partitioning? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: get_blocks_inventory_for_reward_cycle()] [Height Range Error] The function calculates (start_height, end_height) from reward cycle boundaries - if start_height > end_height due to calculation error, what blocks are returned, and can this cause inventory corruption? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: load_staging_block_info()] [Index Collision] The query uses index_block_hash which combines consensus_hash and block_hash - but if StacksBlockId has hash collisions, can this return the wrong block's staging info? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: inner_get_block_header_hashes()] [SQL Injection Risk] The function uses format!() to construct SQL with column names - while column names come from code, can internal corruption or tampering cause SQL injection through these columns? (Low)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: get_known_consensus_hashes_for_block()] [Consensus Hash Confusion] The function returns all consensus hashes for a given block hash - if the same Stacks block appears in multiple PoX forks, can this cause validation confusion about which fork a block belongs to? (Medium)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: setup_block()] [Cost Underflow] The microblock_execution_cost calculation subtracts parent_block_cost from clarity_tx.cost_so_far() using .sub().expect() - can incorrect parent cost tracking cause underflow and panic, or worse, negative costs that appear as very large values? (Critical)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: setup_block()] [Block Limit Bypass] The code calls clarity_tx.block_limit() which can return None (logs warning and uses ExecutionCost::max_value()) - can an attacker exploit this fallback to execute transactions beyond the actual block limit? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: process_microblocks_transactions()] [Cost Reset Timing] After processing microblocks, setup_block calls clarity_tx.reset_cost(ExecutionCost::ZERO) - but if microblocks consumed most of the block budget, can this reset allow the anchored block to exceed the total budget? (Critical)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: process_block_transactions()] [Receipt Size Integer Overflow] The total_size tracking uses saturating_add - but if tx_receipt.size() can return a very large value due to malformed receipts, can saturating_add cause total_size to stop growing and bypass MAX_RECEIPT_SIZES check? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: make_block_dir()] [Directory Traversal] The function constructs a file path from block_hash bytes using to_hex() - can crafted block hashes containing path separators or escape sequences cause directory traversal vulnerabilities? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: atomic_file_write()] [Crash Inconsistency] The function renames .tmp to final path but doesn't fsync the directory - can a crash after rename but before dir sync cause the file to disappear on recovery? (Medium)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: load_block_bytes()] [Size Check Race] The function checks sz > MAX_MESSAGE_LEN and returns Ok(None), but the file could be modified between get_file_size and read_to_end - can this allow loading blocks larger than MAX_MESSAGE_LEN? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: consensus_load()] [Deserialize Bomb] The function uses BoundReader with MAX_MESSAGE_LEN limit, but consensus_deserialize can still be expensive on complex/nested structures - can an attacker cause CPU exhaustion with carefully crafted data that fits in the size limit? (High)",
  "[File: stackslib/src/chainstate/stacks/db/blocks.rs] [Function: has_stored_block()] [TOCTOU File Check] The function first checks staging status in DB, then calls has_block_indexed to check filesystem - can a file be deleted between the DB check and filesystem check, causing inconsistent results? (Medium)"
]