[
  "[File: stacks-core/stackslib/src/net/neighbors/comms.rs] [Function: cancel_inflight()] [Drop Behavior] At line 649, ongoing_batch_request is set to None, dropping the NeighborCommsRequest - does its Drop implementation properly clean up all ReplyHandleP2P objects in the state HashMap? (High)",
  "[File: stacks-core/stackslib/src/net/neighbors/comms.rs] [Function: reset()] [Cleanup Order] At lines 440-443, the order is take_broken, take_dead, cancel_inflight, clear_pinned - is this the correct cleanup order? Could changing it cause issues? (Low)",
  "[File: stacks-core/stackslib/src/net/neighbors/comms.rs] [Function: neighbor_handshake()] [Message Construction] At line 102, HandshakeData::from_local_peer() is called - but is there validation that the constructed handshake data is valid and won't be rejected by the remote peer? (Medium)",
  "[File: stacks-core/stackslib/src/net/neighbors/comms.rs] [Function: neighbor_send_only()] [Message Validation] At line 331, msg_payload is signed and sent without validation - could a malformed StacksMessageType bypass protocol checks? (High)",
  "[File: stacks-core/stackslib/src/net/neighbors/comms.rs] [Function: collect_replies()] [Message Validation] At line 635, drive_socket_io() returns messages but there's no validation before returning them to the caller - are these messages guaranteed to be well-formed and from authenticated peers? (High)",
  "[File: stacks-core/stackslib/src/net/neighbors/comms.rs] [Function: is_message_stale()] [Constant Validation] MAX_NEIGHBOR_BLOCK_DELAY is used at line 709 but not validated - what if it's set to 0 or an extremely large value? Could this break staleness checks? (Medium)",
  "[File: stacks-core/stackslib/src/net/neighbors/comms.rs] [Function: neighbor_connect_and_handshake()] [Connection Validation] At line 182, can_register_peer() returns Ok but there's no validation that the connection will succeed before calling connect_peer() at line 184 - can this waste resources on invalid peers? (Low)",
  "[File: stacks-core/stackslib/src/net/neighbors/comms.rs] [Function: add_batch_request()] [DoS] There's no limit on batch size in add_batch_request() - can a single malicious component add unlimited requests to exhaust memory? (Critical)",
  "[File: stacks-core/stackslib/src/net/neighbors/comms.rs] [Function: add_connecting()] [Connection Flooding] Can an attacker repeatedly connect and disconnect to fill the connecting HashMap with stale entries that are never cleaned up until timeout? (High)",
  "[File: stacks-core/stackslib/src/net/neighbors/comms.rs] [Function: drive_socket_io()] [CPU Exhaustion] At line 483, state.drain() iterates all entries - if an attacker adds thousands of entries, does this cause CPU exhaustion in a single call? (High)",
  "[File: stacks-core/stackslib/src/net/neighbors/comms.rs] [Function: neighbor_try_recv()] [I/O Flooding] At line 359, saturate_p2p_socket() is called for every receive attempt - can repeated calls exhaust I/O capacity or cause socket buffer overflow? (High)",
  "[File: stacks-core/stackslib/src/net/neighbors/comms.rs] [Function: collect_replies()] [Amplification] If multiple callers repeatedly call collect_replies() without waiting, does this cause repeated processing of the same batch, amplifying CPU usage? (Medium)",
  "[File: stacks-core/stackslib/src/net/neighbors/comms.rs] [Function: has_neighbor_session()] [Query Flooding] The function performs network lookups via get_neighbor_convo() - can repeated calls to this function cause excessive lock contention or cache pressure? (Medium)",
  "[File: st\n\n### Citations\n\n**File:** stackslib/src/net/neighbors/comms.rs (L34-43)\n```rust\n    fn add_connecting<NK: ToNeighborKey>(\n        &mut self,\n        network: &PeerNetwork,\n        nk: &NK,\n        event_id: usize,\n    );\n    /// Get a connecting neighbor's event ID\n    fn get_connecting<NK: ToNeighborKey>(&self, network: &PeerNetwork, nk: &NK) -> Option<usize>;\n    /// Remove a neighbor from connecting state\n    fn remove_connecting<NK: ToNeighborKey>(&mut self, network: &PeerNetwork, nk: &NK);\n```\n\n**File:** stackslib/src/net/neighbors/comms.rs (L94-144)\n```rust\n    fn neighbor_handshake<NK: ToNeighborKey>(\n        &mut self,\n        network: &mut PeerNetwork,\n        neighbor_addr: &NK,\n    ) -> Result<ReplyHandleP2P, net_error> {\n        let nk = neighbor_addr.to_neighbor_key(network);\n\n        // send handshake.\n        let handshake_data = HandshakeData::from_local_peer(network.get_local_peer());\n\n        debug!("
]